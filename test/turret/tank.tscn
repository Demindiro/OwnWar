[gd_scene load_steps=14 format=2]

[ext_resource path="res://camera/free_camera.gd" type="Script" id=1]
[ext_resource path="res://test/turret/wheel.tscn" type="PackedScene" id=2]

[sub_resource type="CubeMesh" id=1]
size = Vector3( 200, 2, 200 )

[sub_resource type="BoxShape" id=2]
extents = Vector3( 1000, 1, 1000 )

[sub_resource type="GDScript" id=3]
script/source = "extends VehicleBody


var turnrate := 0.0
var wheelturn := 0.0
var drive := 0.0


func _process(_delta):
	turnrate = 0.0
	wheelturn = 0.0
	drive = 0.0
	if Input.is_key_pressed(KEY_KP_4):
		turnrate -= PI / 3
	if Input.is_key_pressed(KEY_KP_6):
		turnrate += PI / 3
	if Input.is_key_pressed(KEY_LEFT):
		wheelturn += 0.7
	if Input.is_key_pressed(KEY_RIGHT):
		wheelturn -= 0.7
	if Input.is_key_pressed(KEY_UP):
		drive += 1.0
	if Input.is_key_pressed(KEY_DOWN):
		drive -= 1.0
			

func _physics_process(_delta):
	$\"TurretJoint\".set(\"angular_motor_x/target_velocity\", turnrate)
	$WheelFR.steering = wheelturn
	$WheelFL.steering = wheelturn
	$WheelBR.engine_force = drive * 100.0
	$WheelBL.engine_force = drive * 100.0
	if drive == 0.0:
		$WheelBR.brake = 30.0
		$WheelBL.brake = 30.0
		
"

[sub_resource type="BoxShape" id=4]
extents = Vector3( 0.75, 0.5, 2 )

[sub_resource type="CubeMesh" id=5]
size = Vector3( 1.5, 1, 4 )

[sub_resource type="BoxShape" id=6]
extents = Vector3( 0.625, 0.125, 1 )

[sub_resource type="CylinderShape" id=7]
radius = 0.1
height = 1.75

[sub_resource type="CubeMesh" id=8]
size = Vector3( 1.25, 0.2, 2 )

[sub_resource type="CylinderMesh" id=9]
top_radius = 0.1
bottom_radius = 0.1

[sub_resource type="BoxShape" id=10]
extents = Vector3( 0.2, 0.2, 0.2 )

[sub_resource type="CubeMesh" id=11]
size = Vector3( 0.4, 0.4, 0.4 )

[node name="Tank" type="Node"]

[node name="StaticBody" type="StaticBody" parent="."]

[node name="MeshInstance" type="MeshInstance" parent="StaticBody"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -0.00276494, -1, 0.00863695 )
mesh = SubResource( 1 )
material/0 = null

[node name="CollisionShape" type="CollisionShape" parent="StaticBody"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -1, 0 )
shape = SubResource( 2 )

[node name="VehicleBody" type="VehicleBody" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -3, 4.75988, 0 )
script = SubResource( 3 )

[node name="CollisionShape" type="CollisionShape" parent="VehicleBody"]
shape = SubResource( 4 )

[node name="MeshInstance" type="MeshInstance" parent="VehicleBody"]
mesh = SubResource( 5 )
material/0 = null

[node name="WheelBR" parent="VehicleBody" instance=ExtResource( 2 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -1, -0.264493, -1.875 )
suspension_travel = 0.2
suspension_stiffness = 70.0
suspension_max_force = 400.0
damping_compression = 0.5
damping_relaxation = 0.8

[node name="WheelBL" parent="VehicleBody" instance=ExtResource( 2 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 1, -0.264493, -1.875 )
suspension_travel = 0.2
suspension_stiffness = 70.0
suspension_max_force = 400.0
damping_compression = 0.5
damping_relaxation = 0.8

[node name="WheelFR" parent="VehicleBody" instance=ExtResource( 2 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -1, -0.264493, 1.875 )
suspension_travel = 0.2
suspension_stiffness = 70.0
suspension_max_force = 400.0
damping_compression = 0.5
damping_relaxation = 0.8

[node name="WheelFL" parent="VehicleBody" instance=ExtResource( 2 )]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 1, -0.264493, 1.875 )
suspension_travel = 0.2
suspension_stiffness = 70.0
suspension_max_force = 400.0
damping_compression = 0.5
damping_relaxation = 0.8

[node name="TurretJoint" type="Generic6DOFJoint" parent="VehicleBody"]
transform = Transform( 1.91069e-15, 4.37114e-08, -1, 1, -4.37114e-08, 0, -4.37114e-08, -1, -4.37114e-08, 0, 0, 0 )
nodes/node_a = NodePath("..")
nodes/node_b = NodePath("../../Turret")
angular_limit_x/enabled = false
angular_motor_x/enabled = true
angular_limit_y/softness = 0.01
angular_limit_y/restitution = 0.1

[node name="Turret" type="RigidBody" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -3, 5.5, 0 )

[node name="CollisionShape" type="CollisionShape" parent="Turret"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -0.375 )
shape = SubResource( 6 )

[node name="CollisionShape2" type="CollisionShape" parent="Turret"]
transform = Transform( 1, 0, 0, 0, -4.37114e-08, -1, 0, 1, -4.37114e-08, 0, 0, 1.375 )
shape = SubResource( 7 )

[node name="MeshInstance" type="MeshInstance" parent="Turret"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -0.375 )
mesh = SubResource( 8 )
material/0 = null

[node name="MeshInstance2" type="MeshInstance" parent="Turret"]
transform = Transform( 1, 0, 0, 0, -4.37114e-08, -1, 0, 1, -4.37114e-08, 0, 0, 1.25 )
mesh = SubResource( 9 )
material/0 = null

[node name="DirectionalLight" type="DirectionalLight" parent="."]
transform = Transform( 0.866025, 0.129409, -0.482963, 0, 0.965926, 0.258819, 0.5, -0.224144, 0.836516, 0, 4, 0 )

[node name="Camera" type="Camera" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 3.98468, 20 )
script = ExtResource( 1 )

[node name="RigidBody" type="RigidBody" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -3.38146, 5.50522, 1.49442 )
mass = 30.0

[node name="CollisionShape" type="CollisionShape" parent="RigidBody"]
shape = SubResource( 10 )
__meta__ = {
"_edit_lock_": true
}

[node name="MeshInstance" type="MeshInstance" parent="RigidBody"]
mesh = SubResource( 11 )
material/0 = null
__meta__ = {
"_edit_lock_": true
}
